<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="product">
<<<<<<< HEAD
	<sql id="productWhere">
		<where>
			<if test="sval != null and sval != ''">
				<if test="stype == 'all'">
					pname LIKE '%${sval}%'
				</if>
				<if test="stype != 'all'">
					pcompany=${stype} AND pname LIKE '%${sval}%'
				</if>
			</if>
		</where>
	</sql>
	<select id="selectAll" resultType="jcappy.product.ProductVo" parameterType="jcappy.product.ProductVo">
=======
	
	<select id="selectAll" resultType="jcappy.product.ProductVo">
>>>>>>> branch 'master' of https://github.com/Ummnaa/team_jcappy.git
		SELECT * FROM product
		<include refid="productWhere"/>
		<if test="orderby == 'popular'">
			ORDER BY (select AVG(review.rstar) FROM review)
		</if>
		<if test="orderby != 'popular'">
			ORDER BY ${orderby}
		</if>
		${direct}
		LIMIT ${startIndex}, ${pageRow}
	</select>
	<select id="detail" resultType="jcappy.product.ProductVo" parameterType="jcappy.product.ProductVo">
		SELECT * FROM product WHERE pno=#{pno}
	</select>
	
	<insert id="insert" parameterType="jcappy.product.ProductVo">
		INSERT INTO product (pno, pimg1_org, pimg1_real, pimg2_org, pimg2_real, pimg3_org, pimg3_real, pprice, pname, pcompany, pcount, ptype, pcate, pregdate, pdetail)
		VALUES (#{pno}, #{pimg1_org}, #{pimg1_real}, #{pimg2_org}, #{pimg2_real}, #{pimg3_org}, #{pimg3_real}, #{pprice}, #{pname}, #{pcompany}, #{pcount}, #{ptype}, #{pcate}, NOW(), #{pdetail})
	</insert>
	
	<select id="count" resultType="int" parameterType="jcappy.product.ProductVo">
		SELECT COUNT(*) FROM product
	</select>
	
	<update id="update" parameterType="jcappy.product.ProductVo">
		UPDATE product SET
			pno=#{pno}, pprice=#{pprice}, pname=#{pname}, pcount=#{pcount}, pregdate=NOW(), content=#{content}, content=#{content}
		WHERE pno=#{pno}
	</update>
	
	<delete id="delete" parameterType="jcappy.product.ProductVo">
		DELETE FROM product WHERE pno=#{pno}
	</delete>
	
</mapper>